# 実装計画

- [x] 1. プロジェクト構造の確認と基本セットアップ

  - 既存の`contract`フォルダの構造を確認し、必要な依存関係を追加
  - OpenZeppelin Contracts の依存関係を確認・更新
  - TypeScript 設定と Prettier 設定を確認
  - _要件: 6.1, 6.2_

- [x] 2. USDCRewardContract の基本構造実装

  - [x] 2.1 コントラクトの基本構造とインポート文を作成

    - OpenZeppelin ライブラリ（Ownable, Pausable, ReentrancyGuard）をインポート
    - IERC20 インターフェースをインポート
    - 継承関係を定義
    - _要件: 6.1, 6.2, 7.4_

  - [x] 2.2 状態変数とカスタムエラーを定義

    - pointBalances mapping、exchangeRate、usdcToken を定義
    - カスタムエラー（InsufficientPoints、InvalidAddress など）を定義
    - イベント定義（PointsAdded、USDCClaimed など）を追加
    - _要件: 1.4, 2.2, 3.5, 4.1, 5.4, 7.1, 7.2_

  - [x] 2.3 コンストラクタを実装
    - USDC トークンアドレスを受け取るコンストラクタを作成
    - 初期化処理を実装
    - _要件: 6.1_

- [x] 3. ポイント管理機能の実装

  - [x] 3.1 addPoints 関数を実装

    - 管理者権限チェック（onlyOwner）を追加
    - アドレス検証とゼロ金額チェックを実装
    - ポイント残高を増加させる処理を実装
    - PointsAdded イベントを発行
    - _要件: 1.1, 1.4, 7.1, 7.2_

  - [x] 3.2 transferPoints 関数を実装

    - 管理者権限チェック（onlyOwner）を追加
    - アドレス検証とゼロ金額チェックを実装
    - 残高不足チェックを実装
    - ポイント残高を減少させる処理を実装
    - PointsTransferred イベントを発行
    - _要件: 1.2, 1.3, 1.4, 7.1, 7.2_

  - [x] 3.3 getPointBalance 関数を実装
    - ユーザーのポイント残高を返す view 関数を実装
    - _要件: 4.1_

- [x] 4. 交換レート管理機能の実装

  - [x] 4.1 setExchangeRate 関数を実装

    - 管理者権限チェック（onlyOwner）を追加
    - 交換レートを設定する処理を実装
    - ExchangeRateSet イベントを発行
    - _要件: 2.1, 2.2, 2.3_

  - [x] 4.2 calculateUSDCAmount 関数を実装
    - ポイント量から USDC 金額を計算する view 関数を実装
    - 交換レート未設定時の処理を実装
    - _要件: 4.2, 4.3_

- [x] 5. USDC 請求機能の実装

  - [x] 5.1 claimUSDC 関数を実装

    - whenNotPaused と nonReentrant 修飾子を追加
    - ポイント残高チェックを実装
    - USDC 金額計算処理を実装
    - コントラクト USDC 残高チェックを実装
    - ポイント残高減少と USDC 転送処理を実装
    - USDCClaimed イベントを発行
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 2.4_

  - [x] 5.2 内部関数\_transferUSDC を実装
    - USDC 転送処理を実装
    - 転送失敗時のエラーハンドリングを実装
    - _要件: 3.1, 3.4_

- [x] 6. USDC 供給管理機能の実装

  - [x] 6.1 depositUSDC 関数を実装

    - 管理者権限チェック（onlyOwner）を追加
    - USDC をコントラクトに転送する処理を実装
    - USDCDeposited イベントを発行
    - _要件: 5.1, 5.4_

  - [x] 6.2 withdrawUSDC 関数を実装
    - 管理者権限チェック（onlyOwner）を追加
    - コントラクトから USDC を出金する処理を実装
    - USDCWithdrawn イベントを発行
    - _要件: 5.2, 5.3, 5.4_

- [x] 7. 一時停止機能とアクセス制御の実装

  - [x] 7.1 pause/unpause 関数を実装

    - 管理者権限チェック（onlyOwner）を追加
    - 一時停止状態の切り替え処理を実装
    - ContractPaused/ContractUnpaused イベントを発行
    - _要件: 7.3_

  - [x] 7.2 内部関数\_validateAddress を実装
    - ゼロアドレスチェック処理を実装
    - InvalidAddress エラーを発行
    - _要件: 7.1_

- [x] 8. 単体テストの実装

  - [x] 8.1 ポイント管理機能のテストを作成

    - addPoints 関数の正常系・異常系テストを実装
    - transferPoints 関数の正常系・異常系テストを実装
    - 権限チェックとイベント発行のテストを実装
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [x] 8.2 交換レート管理機能のテストを作成

    - setExchangeRate 関数のテストを実装
    - calculateUSDCAmount 関数のテストを実装
    - 権限チェックとイベント発行のテストを実装
    - _要件: 2.1, 2.2, 2.3, 4.2, 4.3_

  - [x] 8.3 USDC 請求機能のテストを作成

    - claimUSDC 関数の正常系・異常系テストを実装
    - 残高不足とコントラクト残高不足のテストを実装
    - リエントランシー防止のテストを実装
    - _要件: 3.1, 3.2, 3.3, 3.4, 3.5, 7.4_

  - [x] 8.4 USDC 供給管理機能のテストを作成

    - depositUSDC 関数のテストを実装
    - withdrawUSDC 関数のテストを実装
    - 権限チェックのテストを実装
    - _要件: 5.1, 5.2, 5.3, 5.4_

  - [x] 8.5 アクセス制御と一時停止機能のテストを作成

    - pause/unpause 機能のテストを実装
    - 一時停止時の動作制限テストを実装
    - 所有権移転のテストを実装
    - _要件: 6.1, 6.2, 6.3, 6.4, 7.3_

  - [x] 8.6 エッジケースとセキュリティテストを作成
    - ゼロアドレス・ゼロ金額処理のテストを実装
    - 交換レート未設定時の動作テストを実装
    - カスタムエラーの発行テストを実装
    - _要件: 7.1, 7.2, 7.3, 7.4_

- [x] 9. 統合テストの実装

  - [x] 9.1 エンドツーエンドフローテストを作成

    - ポイント付与から USDC 請求までの完全フローテストを実装
    - 複数ユーザーでの同時操作テストを実装
    - _要件: 1.1, 1.2, 2.1, 3.1, 3.2_

  - [x] 9.2 USDC トークンとの統合テストを作成
    - モック USDC トークンを使用した統合テストを実装
    - トークン転送と残高更新の確認テストを実装
    - _要件: 3.1, 5.1, 5.2_

- [x] 10. Hardhat タスクの実装

  - [x] 10.1 基本的なコントラクト操作タスクを作成

    - `tasks/usdcRewardContract`フォルダを作成
    - ポイント追加・送金タスクを実装
    - 交換レート設定タスクを実装
    - _要件: 1.1, 1.2, 2.1_

  - [x] 10.2 USDC 管理タスクを作成

    - USDC 入金・出金タスクを実装
    - 残高確認タスクを実装
    - _要件: 5.1, 5.2, 4.1_

  - [x] 10.3 管理機能タスクを作成
    - 一時停止・再開タスクを実装
    - 所有権移転タスクを実装
    - _要件: 6.2, 6.4, 7.3_

- [x] 11. デプロイメントスクリプトの実装

  - [x] 11.1 Hardhat Ignition デプロイスクリプトを作成

    - Base Sepolia 用のデプロイ設定を実装
    - 環境変数から USDC トークンアドレスを取得
    - デプロイ後の初期設定スクリプトを実装
    - _要件: 6.1_

  - [x] 11.2 デプロイ検証スクリプトを作成
    - デプロイ後の動作確認スクリプトを実装
    - コントラクト設定の検証スクリプトを実装
    - _要件: 6.1_

- [x] 12. ドキュメントの作成

  - [x] 12.1 README ファイルを更新

    - プロジェクトセットアップ手順を記載
    - コントラクトの使用方法を記載
    - テスト実行方法を記載
    - デプロイ手順を記載
    - _要件: 全要件_

  - [x] 12.2 API 仕様書を作成
    - 全関数の仕様とパラメータを記載
    - イベントとエラーの仕様を記載
    - 使用例を記載
    - _要件: 全要件_
